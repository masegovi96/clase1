<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programación Avanzada</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="icon" type="image/jpeg" href="../media/jigsaw.jpg">
</head>

<body>
    <!-- Menú Lateral -->
    <div id="navbar-container"></div>

    <div class="container mt-5">
        <h1 class="text-center mb-4">Recursividad</h1>

        <!-- Descripción -->
        <section class="mb-4">
            <h2>¿Qué es la Recursividad?</h2>
            <p>La recursividad es una técnica en programación donde una función se llama a sí misma para resolver un
                problema más grande dividiéndolo en subproblemas más pequeños. Es especialmente útil para problemas como
                cálculos matemáticos, recorridos de estructuras de datos y algoritmos de búsqueda.</p>
        </section>

        <!-- Funcionamiento Interno -->
        <section class="mb-4">
            <h2>Funcionamiento Interno</h2>
            <p>Cuando una función se llama a sí misma, cada llamada se apila en la pila de llamadas del sistema. Una vez
                que se alcanza la condición base, las llamadas se resuelven en orden inverso, desapilándose una por una.
            </p>
        </section>

        <!-- Recursividad vs Iteración -->
        <section class="mb-4">
            <h2>Recursividad vs Iteración</h2>
            <p>La recursividad puede simplificar el código y hacerlo más legible, especialmente para problemas que se
                definen naturalmente de forma recursiva. Sin embargo, la iteración suele ser más eficiente en términos
                de uso de memoria y tiempo de ejecución.</p>
        </section>

        <!-- Buenas Prácticas -->
        <section class="mb-4">
            <h2>Buenas Prácticas</h2>
            <ul>
                <li>Definir claramente la condición base para evitar llamadas infinitas.</li>
                <li>Evitar llamadas recursivas innecesarias que puedan causar desbordamiento de pila.</li>
                <li>Considerar el uso de memoización para mejorar la eficiencia en funciones recursivas que realizan
                    cálculos repetitivos.</li>
            </ul>
        </section>

        <!-- Errores Comunes -->
        <section class="mb-4">
            <h2>Errores Comunes</h2>
            <ul>
                <li>Olvidar definir una condición base adecuada.</li>
                <li>Realizar llamadas recursivas que no reducen el problema, lo que puede llevar a una recursión
                    infinita.</li>
                <li>Consumir demasiada memoria debido a un número excesivo de llamadas recursivas.</li>
            </ul>
        </section>

        <!-- Ventajas y Desventajas -->
        <section class="mb-4">
            <h2>Ventajas y Desventajas</h2>
            <ul>
                <li><strong>Ventajas:</strong> Simplifica problemas complejos, reduce el código necesario, y puede hacer
                    que el código sea más claro y fácil de entender.</li>
                <li><strong>Desventajas:</strong> Puede consumir más memoria y ser menos eficiente si no se maneja
                    correctamente.</li>
            </ul>
        </section>

        <!-- Ejemplos comunes -->
        <section class="mb-4">
            <h2>Ejemplos Comunes</h2>
            <ul>
                <li>Cálculo de factoriales</li>
                <li>Fibonacci</li>
                <li>Búsqueda en árboles</li>
                <li>Dividir y conquistar (Merge Sort, Quick Sort)</li>
            </ul>
        </section>

        <!-- Botón para ver la animación -->
        <div class="text-center mb-4">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#animationModal">Ver
                animación</button>
        </div>

        <!-- Botones de ejemplos -->
        <div class="text-center">
            <button class="btn btn-secondary me-2" data-bs-toggle="modal" data-bs-target="#phpExampleModal">Ejemplo en
                PHP</button>
            <button class="btn btn-secondary me-2" data-bs-toggle="modal"
                data-bs-target="#javascriptExampleModal">Ejemplo en
                JavaScript</button>
            <button class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#pythonExampleModal">Ejemplo en
                Python</button>
        </div>
    </div>

    <!-- Modal para la animación -->
    <div class="modal fade" id="animationModal" tabindex="-1" aria-labelledby="animationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="animationModalLabel">Animación: Cómo funciona la Recursividad</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="recursionAnimation" style="width: 100%; height: 700px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Ejemplo en PHP -->
    <div class="modal fade" id="phpExampleModal" tabindex="-1" aria-labelledby="phpExampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="phpExampleModalLabel">Ejemplo en PHP</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <pre class="d-inline-block text-start"><code class="language-php">
function factorial($n) {
    if ($n === 0) {
        return 1;
    }
    return $n * factorial($n - 1);
}

echo factorial(5); // Salida: 120
                        </code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Ejemplo en JavaScript -->
    <div class="modal fade" id="javascriptExampleModal" tabindex="-1" aria-labelledby="javascriptExampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="javascriptExampleModalLabel">Ejemplo en JavaScript</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <pre class="d-inline-block text-start"><code class="language-javascript">
function factorial(n) {
    if (n === 0) {
        return 1;
    }
    return n * factorial(n - 1);
}

console.log(factorial(5)); // Salida: 120
                        </code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Ejemplo en Python -->
    <div class="modal fade" id="pythonExampleModal" tabindex="-1" aria-labelledby="pythonExampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pythonExampleModalLabel">Ejemplo en Python</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <pre class="d-inline-block text-start"><code class="language-python">
def factorial(n):
    if n == 0:
        return 1
    return n * factorial(n - 1)

print(factorial(5)) # Salida: 120
                        </code></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-dark text-white text-center py-3">
        Desarrollado por MTIC. Mario Alonso Segovia Gutiérrez
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/scripts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('animationModal');
            modal.addEventListener('shown.bs.modal', drawRecursiveAnimation);

            function drawRecursiveAnimation() {
                const svgWidth = document.getElementById("recursionAnimation").offsetWidth;
                const svgHeight = 700;
                const boxWidth = 200;
                const boxHeight = 50;
                const verticalSpacing = 80;
                const animationDuration = 1000;
                const initialX = (svgWidth - boxWidth) / 2;

                // Limpiar animación previa
                d3.select("#recursionAnimation").html("");

                const svg = d3.select("#recursionAnimation")
                    .append("svg")
                    .attr("width", svgWidth)
                    .attr("height", svgHeight);

                const calls = [
                    { level: 0, call: "factorial(4)", returnText: "Retorna: 4 * 6 = 24" },
                    { level: 1, call: "factorial(3)", returnText: "Retorna: 3 * 2 = 6" },
                    { level: 2, call: "factorial(2)", returnText: "Retorna: 2 * 1 = 2" },
                    { level: 3, call: "factorial(1)", returnText: "Retorna: 1 * 1 = 1" },
                    { level: 4, call: "factorial(0)", returnText: "Caso base: retorna 1" }
                ];

                svg.append("text")
                    .attr("x", svgWidth / 2)
                    .attr("y", 40)
                    .attr("text-anchor", "middle")
                    .attr("font-size", "24px")
                    .attr("font-weight", "bold")
                    .text("Recursividad: Factorial(4)");

                const stackGroup = svg.append("g");

                // Fase descendente (llamadas)
                calls.forEach((step, index) => {
                    const y = 100 + index * verticalSpacing;

                    const box = stackGroup.append("rect")
                        .attr("x", initialX)
                        .attr("y", -boxHeight) // Empieza fuera de la pantalla
                        .attr("width", boxWidth)
                        .attr("height", boxHeight)
                        .attr("rx", 10)
                        .attr("ry", 10)
                        .attr("fill", "#0d6efd");

                    const label = stackGroup.append("text")
                        .attr("x", initialX + boxWidth / 2)
                        .attr("y", -boxHeight / 2) // Empieza fuera de la pantalla
                        .attr("text-anchor", "middle")
                        .attr("fill", "white")
                        .attr("font-size", "16px")
                        .text(step.call);

                    box.transition()
                        .delay(index * animationDuration)
                        .duration(500)
                        .attr("y", y);

                    label.transition()
                        .delay(index * animationDuration)
                        .duration(500)
                        .attr("y", y + boxHeight / 2);
                });

                // Fase ascendente (retornos)
                calls.slice().reverse().forEach((step, i) => {
                    const index = calls.length - 1 - i;
                    const y = 100 + index * verticalSpacing;
                    const delayBase = (calls.length + i) * animationDuration;

                    const returnText = stackGroup.append("text")
                        .attr("x", initialX + boxWidth / 2)
                        .attr("y", y + boxHeight / 2)
                        .attr("text-anchor", "middle")
                        .attr("fill", "#198754")
                        .attr("font-size", "16px")
                        .attr("opacity", 0)
                        .text(step.returnText);

                    returnText.transition()
                        .delay(delayBase)
                        .duration(500)
                        .attr("opacity", 1);

                    stackGroup.selectAll("rect")
                        .filter((d, j) => j === index)
                        .transition()
                        .delay(delayBase + 500)
                        .duration(500)
                        .attr("y", svgHeight + boxHeight); // Mover fuera de la pantalla

                    stackGroup.selectAll("text")
                        .filter((d, j) => j === index)
                        .transition()
                        .delay(delayBase + 500)
                        .duration(500)
                        .attr("y", svgHeight + boxHeight);
                });
            }
        });
    </script>
</body>

</html>